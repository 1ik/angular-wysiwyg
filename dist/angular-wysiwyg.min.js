"use strict";angular.module("wysiwyg.module",["colorpicker.module"]).directive("wysiwyg",["$timeout","wysiwgGui","$compile",function(t,e,n){return{template:"<div></div>",restrict:"E",scope:{value:"=ngModel",textareaHeight:"@textareaHeight",textareaName:"@textareaName",textareaPlaceholder:"@textareaPlaceholder",textareaClass:"@textareaClass",textareaRequired:"@textareaRequired",textareaId:"@textareaId",textareaMenu:"@textareaMenu"},replace:!0,require:"ngModel",link:function(i,a,o,r){function s(t){var e=window.getSelection().getRangeAt(0);return e&&(e.startContainer.parentNode.tagName===t.toUpperCase()||e.endContainer.parentNode.tagName===t.toUpperCase())?!0:!1}function l(){var t=window.getSelection().getRangeAt(0);if(t){var e=$(t.startContainer.parentNode).attr("style");if(!angular.isDefined(e))return!1;for(var n=e.split(";"),i=0;i<n.length;i++){var a=n[i].split(":");if("background-color"===a[0])return a[1]}return"#fff"}return"#fff"}a.html(e.createMenu(o.textareaMenu)),n(a.contents())(i);var c=a.find("div.wysiwyg-textarea");i.fonts=["Georgia","Palatino Linotype","Times New Roman","Arial","Helvetica","Arial Black","Comic Sans MS","Impact","Lucida Sans Unicode","Tahoma","Trebuchet MS","Verdana","Courier New","Lucida Console","Helvetica Neue"].sort(),i.font=i.fonts[6],i.fontSizes=[{value:"1",size:"10px"},{value:"2",size:"13px"},{value:"3",size:"16px"},{value:"4",size:"18px"},{value:"5",size:"24px"},{value:"6",size:"32px"},{value:"7",size:"48px"}],i.fontSize=i.fontSizes[1],"true"===o.enableBootstrapTitle&&void 0!==o.enableBootstrapTitle&&a.find("button[title]").tooltip({container:"body"}),c.on("input keyup paste mouseup",function(){var t=c.html();"<br>"==t&&(t=""),r.$setViewValue(t)}),i.isLink=!1,c.on("click keyup focus mouseup",function(){t(function(){i.isBold=i.cmdState("bold"),i.isUnderlined=i.cmdState("underline"),i.isStrikethrough=i.cmdState("strikethrough"),i.isItalic=i.cmdState("italic"),i.isSuperscript=s("SUP"),i.isSubscript=s("SUB"),i.isRightJustified=i.cmdState("justifyright"),i.isLeftJustified=i.cmdState("justifyleft"),i.isCenterJustified=i.cmdState("justifycenter"),i.isPre="pre"==i.cmdValue("formatblock"),i.isBlockquote="blockquote"==i.cmdValue("formatblock"),i.isOrderedList=i.cmdState("insertorderedlist"),i.isUnorderedList=i.cmdState("insertunorderedlist"),i.fonts.forEach(function(t){return i.cmdValue("fontname").indexOf(t)>-1?(i.font=t,!1):void 0}),i.fontSizes.forEach(function(t){return i.cmdValue("fontsize")===t.value?(i.fontSize=t,!1):void 0}),i.hiliteColor=l(),a.find("button.wysiwyg-hiliteColor").css("background-color",i.hiliteColor),i.fontColor=i.cmdValue("forecolor"),a.find("button.wysiwyg-fontcolor").css("color",i.fontColor),i.isLink=s("A")},10)}),r.$render=function(){c.html(r.$viewValue)},i.format=function(t,e){document.execCommand(t,!1,e)},i.cmdState=function(t){return document.queryCommandState(t)},i.cmdValue=function(t){return document.queryCommandValue(t)},i.createLink=function(){var t=prompt("Enter the link URL");t&&void 0!==t&&i.format("createlink",t)},i.insertImage=function(){var t=prompt("Enter the image URL");t&&void 0!==t&&i.format("insertimage",t)},i.setFont=function(){i.format("fontname",i.font)},i.setFontSize=function(){i.format("fontsize",i.fontSize.value)},i.setFontColor=function(){i.format("forecolor",i.fontColor)},i.setHiliteColor=function(){i.format("hiliteColor",i.hiliteColor)},i.format("enableobjectresizing",!0),i.format("styleWithCSS",!0)}}}]).factory("wysiwgGui",function(){var t=[["bold","italic","underline","strikethrough","subscript","superscript"],["font"],["font-size"],["font-color","hilite-color"],["remove-format"],["ordered-list","unordered-list","outdent","indent"],["left-justify","center-justify","right-justify"],["code","quote","paragragh"],["link","image"]],e=function(){return"<style>   .wysiwyg-btn-group-margin{  margin-right:5px; }   .wysiwyg-select{ height:30px;margin-bottom:1px;}   .wysiwyg-colorpicker{ font-family: arial, sans-serif !important;font-size:16px !important; padding:2px 10px !important;}</style>"},n=function(){return'<div id="{{textareaId}}" ng-attr-style="resize:vertical;height:{{textareaHeight || \'80px\'}}; overflow:auto" contentEditable="true" class="{{textareaClass}} wysiwyg-textarea" rows="{{textareaRows}}" name="{{textareaName}}" required="{{textareaRequired}}" placeholder="{{textareaPlaceholder}}" ng-model="value"></div>'},i=function(){return'<div class="btn-group btn-group-sm wysiwyg-btn-group-margin">'},a=function(t){switch(t=t.toLowerCase().replace(" ","-")){case"bold":return'<button title="Bold" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'bold\')" ng-class="{ active: isBold}"><i class="fa fa-bold"></i></button>';case"italic":return'<button title="Italic" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'italic\')" ng-class="{ active: isItalic}"><i class="fa fa-italic"></i></button>';case"underline":return'<button title="Underline" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'underline\')" ng-class="{ active: isUnderlined}"><i class="fa fa-underline"></i></button>';case"strikethrough":return'<button title="Strikethrough" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'strikethrough\')" ng-class="{ active: isStrikethrough}"><i class="fa fa-strikethrough"></i></button>';case"subscript":return'<button title="Subscript" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'subscript\')" ng-class="{ active: isSubscript}"><i class="fa fa-subscript"></i></button>';case"superscript":return'<button title="Superscript" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'superscript\')" ng-class="{ active: isSuperscript}"><i class="fa fa-superscript"></i></button>';case"font":return'<select tabindex="-1"  unselectable="on" class="form-control wysiwyg-select" ng-model="font" ng-options="f for f in fonts" ng-change="setFont()"></select>';case"font-size":return'<select unselectable="on" tabindex="-1" class="form-control wysiwyg-select" ng-model="fontSize" ng-options="f.size for f in fontSizes" ng-change="setFontSize()"></select>';case"font-color":return'<button title="Font Color" tabindex="-1" colorpicker="rgba" type="button" colorpicker-position="top" class="btn btn-default ng-valid ng-dirty wysiwyg-colorpicker wysiwyg-fontcolor" ng-model="fontColor" ng-change="setFontColor()">A</button>';case"hilite-color":return'<button title="Hilite Color" tabindex="-1" colorpicker="rgba" type="button" colorpicker-position="top" class="btn btn-default ng-valid ng-dirty wysiwyg-colorpicker wysiwyg-hiliteColor" ng-model="hiliteColor" ng-change="setHiliteColor()">H</button>';case"remove-format":return'<button title="Remove Formatting" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'removeFormat\')" ><i class="fa fa-eraser"></i></button>';case"ordered-list":return'<button title="Ordered List" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'insertorderedlist\')" ng-class="{ active: isOrderedList}"><i class="fa fa-list-ol"></i></button>';case"unordered-list":return'<button title="Unordered List" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'insertunorderedlist\')" ng-class="{ active: isUnorderedList}"><i class="fa fa-list-ul"></i></button>';case"outdent":return'<button title="Outdent" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'outdent\')"><i class="fa fa-outdent"></i></button>';case"indent":return'<button title="Indent" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'indent\')"><i class="fa fa-indent"></i></button>';case"left-justify":return'<button title="Left Justify" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'justifyleft\')" ng-class="{ active: isLeftJustified}"><i class="fa fa-align-left"></i></button>';case"center-justify":return'<button title="Center Justify" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'justifycenter\')" ng-class="{ active: isCenterJustified}"><i class="fa fa-align-center"></i></button>';case"right-justify":return'<button title="Right Justify" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'justifyright\')" ng-class="{ active: isRightJustified}"><i class="fa fa-align-right"></i></button>';case"code":return'<button title="Code" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'formatblock\', \'pre\')"  ng-class="{ active: isPre}"><i class="fa fa-code"></i></button>';case"quote":return'<button title="Quote" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'formatblock\', \'blockquote\')"  ng-class="{ active: isBlockquote}"><i class="fa fa-quote-right"></i></button>';case"paragragh":return'<button title="Paragragh" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'insertParagraph\')"  ng-class="{ active: isParagraph}">P</button>';case"link":return'<button ng-show="!isLink" tabindex="-1" title="Link" type="button" unselectable="on" class="btn btn-default" ng-click="createLink()"><i class="fa fa-link" ></i> </button><button ng-show="isLink" tabindex="-1" title="Unlink" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'unlink\')"><i class="fa fa-unlink"></i> </button>';case"image":return'<button title="Image" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="insertImage()"><i class="fa fa-picture-o"></i> </button>';default:return console.log("Angular.wysiwyg: Unknown menu item."),""}},o=function(o){o=angular.isDefined(o)&&""!==o?r(o):t;var s='<div class="wysiwyg-menu">';s+=e();for(var l=0;l<o.length;l++){s+=i();for(var c=0;c<o[l].length;c++)s+=a(o[l][c]);s+="</div>"}return s+=n(),s+="</div>"},r=function(t){var e;try{e=JSON.parse(t.replace(/'/g,'"'))}catch(n){}return e};return{createMenu:o}});